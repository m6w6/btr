#!/bin/bash

export DATE=$(date +%Y%m%d%H%M%S)
export CPUS=${CPUS:-$(grep -c "^processor" /proc/cpuinfo)}

export BINDIR=$(realpath $(dirname $0)/)
export LIBDIR=$(realpath $(dirname $0)/../share/btr)

. $LIBDIR/btr.sh

QUIET=false
VERBOSE=false
FORCEYES=false

parseopts "$@"
setup

if $VERBOSE
then
	show_conf
	$FORCEYES || confirm "Everything setup. Do you want to continue?" || exit
fi

set -e
make -e $SILENT_FLAG -C $BTRDIR -f $LIBDIR/source/$SOURCE_RULES.mk
make -e $SILENT_FLAG -C $BTRDIR -f $LIBDIR/build/$BUILD_RULES.mk
make -e $SILENT_FLAG -C $BTRDIR -f $LIBDIR/report/$REPORT_RULES.mk

# vim: noet
